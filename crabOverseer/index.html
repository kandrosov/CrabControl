
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../skim_tree/">
      
      <link rel="icon" href="../assets/cat_square_favicon.ico">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.21">
    
    
      
        <title>crabOverseer - RunKit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
    
    
      <link rel="stylesheet" href="../stylesheets/fonts.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#craboverseer-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="RunKit" class="md-header__button md-logo" aria-label="RunKit" data-md-component="logo">
      
  <img src="../assets/cat_square_small.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RunKit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              crabOverseer
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/kandrosov/RunKit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      crabOverseer
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../skim_tree/" class="md-tabs__link">
      skim_tree
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../otherTools/" class="md-tabs__link">
      Other tools
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="RunKit" class="md-nav__button md-logo" aria-label="RunKit" data-md-component="logo">
      
  <img src="../assets/cat_square_small.jpg" alt="logo">

    </a>
    RunKit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/kandrosov/RunKit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          crabOverseer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        crabOverseer
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#logical-flow" class="md-nav__link">
    Logical flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-configuration-file-format" class="md-nav__link">
    Main configuration file format
  </a>
  
    <nav class="md-nav" aria-label="Main configuration file format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-parameters" class="md-nav__link">
    Supported parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-configuration-file-format" class="md-nav__link">
    Task configuration file format
  </a>
  
    <nav class="md-nav" aria-label="Task configuration file format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#format" class="md-nav__link">
    Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    Actions
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../skim_tree/" class="md-nav__link">
        skim_tree
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../otherTools/" class="md-nav__link">
        Other tools
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#logical-flow" class="md-nav__link">
    Logical flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage" class="md-nav__link">
    Usage
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#main-configuration-file-format" class="md-nav__link">
    Main configuration file format
  </a>
  
    <nav class="md-nav" aria-label="Main configuration file format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#supported-parameters" class="md-nav__link">
    Supported parameters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-configuration-file-format" class="md-nav__link">
    Task configuration file format
  </a>
  
    <nav class="md-nav" aria-label="Task configuration file format">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#format" class="md-nav__link">
    Format
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actions" class="md-nav__link">
    Actions
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/kandrosov/RunKit/edit/master/docs/crabOverseer.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/kandrosov/RunKit/raw/master/docs/crabOverseer.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="craboverseer-documentation">crabOverseer documentation<a class="headerlink" href="#craboverseer-documentation" title="Permanent link">&para;</a></h1>
<p><code>crabOverseer</code> is a tool to manage CRAB tasks and the following post-processing steps.</p>
<p><code>crabOverseer</code> (and, in general, <code>RunKit</code>) is intended as a submodule for a task-specific framework that setups the environment and provides the necessary configuration files.
Here are some examples of frameworks that use <code>RunKit</code>:</p>
<ul>
<li><a href="https://github.com/cms-tau-pog/NanoProd">NanoProd</a></li>
<li><a href="https://github.com/cms-tau-pog/TauMLTools">TauMLTools</a></li>
<li><a href="https://github.com/cms-hh-bbtautau/Framework">HH-&gt;bbtautau framework</a></li>
<li><a href="https://github.com/cms-hnl/HNLProd">HNLProd</a></li>
</ul>
<h2 id="logical-flow">Logical flow<a class="headerlink" href="#logical-flow" title="Permanent link">&para;</a></h2>
<ul>
<li>Preparation steps:<ol>
<li>Setup framework area and environment on the site where the crab outputs will be staged out</li>
<li>Define crabOverseer configurations</li>
<li>Setup VOMS certificates</li>
<li>Make sure that there is enough space to store the crab outputs<ul>
<li>with the current implementation (to be improved), you should reserve 2x the expected size to store intermediate outputs, which can be removed after the post-processing is finished</li>
</ul>
</li>
<li>Run dry-run submission to make sure that setup works as expected</li>
</ol>
</li>
<li>Submission and the main <code>crabOverseer</code> loop:<ol>
<li>Update the status of all active tasks:<ul>
<li>if a task is new, submit it</li>
<li>if a task is submitted on CRAB, update the status</li>
<li>if a task is failed on crab, create and submit a crab recovery task<ul>
<li>if the maximal number of recovery attempts is reached, create local recovery jobs</li>
</ul>
</li>
<li>if a task is finished on CRAB, check that all outputs are present<ul>
<li>if not, create and submit a crab (or local) task</li>
<li>if yes, create a local post-processing job</li>
</ul>
</li>
</ul>
</li>
<li>Submit and monitor the list of local recovery and post-processing jobs defined in the previous step<ul>
<li><a href="https://github.com/riga/law">law</a> is used to submit and monitor the jobs on a local grid</li>
</ul>
</li>
<li>If there are non-finished tasks, wait for <code>updateInterval</code> (starting from the last beginning of step 1) and repeat the loop</li>
<li>If all tasks are finished, finish <code>crabOverseer</code>.</li>
</ol>
</li>
</ul>
<h2 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">&para;</a></h2>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span><span class="o">[</span>-h<span class="o">]</span><span class="w"> </span><span class="o">[</span>--work-area<span class="w"> </span>WORK_AREA<span class="o">]</span><span class="w"> </span><span class="o">[</span>--cfg<span class="w"> </span>CFG<span class="o">]</span><span class="w"> </span><span class="o">[</span>--no-status-update<span class="o">]</span><span class="w"> </span><span class="o">[</span>--update-cfg<span class="o">]</span><span class="w"> </span><span class="o">[</span>--no-loop<span class="o">]</span><span class="w"> </span><span class="o">[</span>--select<span class="w"> </span>SELECT<span class="o">]</span><span class="w"> </span><span class="o">[</span>--action<span class="w"> </span>ACTION<span class="o">]</span><span class="w"> </span><span class="o">[</span>--verbose<span class="w"> </span>VERBOSE<span class="o">]</span><span class="w"> </span><span class="o">[</span>task_file<span class="w"> </span>...<span class="o">]</span>
</code></pre></div>
<p>Command line arguments:</p>
<table>
<thead>
<tr>
<th align="left">Argument</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>-h</strong>, <strong>--help</strong></td>
<td align="left">Show the help message and exit</td>
</tr>
<tr>
<td align="left"><strong>--work-area</strong> WORK_AREA</td>
<td align="left">The working area to store crabOverseer state (default: <em>$PWD/.crabOverseer</em>)</td>
</tr>
<tr>
<td align="left"><strong>--cfg</strong> CFG</td>
<td align="left">The main crabOverseer configuration file (see description <a href="#main-config-file-format">below</a>)</td>
</tr>
<tr>
<td align="left"><strong>task_file</strong></td>
<td align="left">The list of files with a description of tasks to be managed by crabOverseer (see description <a href="#task-configuration-file-format">below</a>)</td>
</tr>
<tr>
<td align="left"><strong>--no-status-update</strong></td>
<td align="left">If specified, do not call crab to update tasks statuses and proceed with the next steps</td>
</tr>
<tr>
<td align="left"><strong>--update-cfg</strong></td>
<td align="left">Update the main and all task configurations from the config files provided in <strong>--cfg</strong> and <strong>task_file</strong> arguments</td>
</tr>
<tr>
<td align="left"><strong>--no-loop</strong></td>
<td align="left">Run one iteration of task update and submission and exit</td>
</tr>
<tr>
<td align="left"><strong>--action</strong> ACTION</td>
<td align="left">Apply an action on the selected tasks and exit (see description <a href="#actions">below</a>)</td>
</tr>
<tr>
<td align="left"><strong>--select</strong> SELECT</td>
<td align="left">Select tasks to which the action should be applied (default: select all)</td>
</tr>
<tr>
<td align="left"><strong>--verbose</strong> VERBOSE</td>
<td align="left">Verbosity level (default: 1)</td>
</tr>
</tbody>
</table>
<p>After the first call, the crabOverseer state is stored in the working area, and the subsequent calls will use it.
Therefore, it is not necessary to provide arguments for the subsequent calls, meaning that the following command will be enough:</p>
<p><div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py
</code></pre></div>
Alternatively, if a non-default working area is used:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--work-area<span class="w"> </span>&lt;working_area&gt;
</code></pre></div></p>
<h2 id="main-configuration-file-format">Main configuration file format<a class="headerlink" href="#main-configuration-file-format" title="Permanent link">&para;</a></h2>
<p>The main <code>crabOversser</code> configuration file uses the <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> format.
It contains definitions that are common for all tasks. A task-specific definition can be defined (or overwritten) in the <a href="#task-configuration-file-format">task configuration file</a>.</p>
<h3 id="supported-parameters">Supported parameters<a class="headerlink" href="#supported-parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>cmsswPython</strong></td>
<td align="left">path to the CMSSW python configuration file. For a nanoAOD production, use <code>RunKit/nanoProdWrapper.py</code>.</td>
</tr>
<tr>
<td align="left"><strong>params</strong></td>
<td align="left">list of parameters that will be passed during execution of <code>cmsRun</code> on the <code>cmsswPython</code> file</td>
</tr>
<tr>
<td align="left"><strong>splitting</strong></td>
<td align="left">Crab job splitting. Currently, only <code>FileBased</code> splitting is supported</td>
</tr>
<tr>
<td align="left"><strong>unitsPerJob</strong></td>
<td align="left">number of units per job (i.e. files per job for <code>FileBased</code> splitting) for the initial task submission. This parameter is decreased by a factor of 2 for each consecutive recovery submission. Suggested value: 16</td>
</tr>
<tr>
<td align="left"><strong>scriptExe</strong></td>
<td align="left">Executable script that will be run on the remote nodes. Suggested value: <code>RunKit/crabJob.sh</code></td>
</tr>
<tr>
<td align="left"><strong>outputFiles</strong></td>
<td align="left">List of output files produced by the crab job. The suggested value for a nanoAOD production: <code>- nano.root</code></td>
</tr>
<tr>
<td align="left"><strong>filesToTransfer</strong></td>
<td align="left">List of files that CRAB will transfer to the remote nodes</td>
</tr>
<tr>
<td align="left"><strong>site</strong></td>
<td align="left">Site where CRAB will transfer jobs outputs. Example: <code>T2_CH_CERN</code></td>
</tr>
<tr>
<td align="left"><strong>crabOutput</strong></td>
<td align="left">The path where jobs outputs will be stored using <code>/store/...</code> notation</td>
</tr>
<tr>
<td align="left"><strong>localCrabOutput</strong></td>
<td align="left">path where <code>crabOutput</code> is mounted in the local file system</td>
</tr>
<tr>
<td align="left"><strong>finalOutput</strong></td>
<td align="left">path in the local file system where the final post-processed outputs will be stored</td>
</tr>
<tr>
<td align="left"><strong>maxMemory</strong></td>
<td align="left">Memory requirements per job in MB. Suggested value: 2500</td>
</tr>
<tr>
<td align="left"><strong>numCores</strong></td>
<td align="left">number of cores per job. Suggested value: 1</td>
</tr>
<tr>
<td align="left"><strong>inputDBS</strong></td>
<td align="left">Input DBS. Suggested value: global</td>
</tr>
<tr>
<td align="left"><strong>allowNonValid</strong></td>
<td align="left">Allow processing datasets listed as not VALID on DAS. Suggested value: False</td>
</tr>
<tr>
<td align="left"><strong>dryrun</strong></td>
<td align="left">Run CRAB in a dry-run mode (for testing). Suggested value: False</td>
</tr>
<tr>
<td align="left"><strong>maxRecoveryCount</strong></td>
<td align="left">Maximal number of recovery attempts. Suggested value:  3</td>
</tr>
<tr>
<td align="left"><strong>updateInterval</strong></td>
<td align="left">Interval in minutes between the task update &amp; post-processing iterations</td>
</tr>
<tr>
<td align="left"><strong>localProcessing</strong></td>
<td align="left">Parameters for the local recovery and post-processing step.</td>
</tr>
<tr>
<td align="left">localProcessing / <strong>lawTask</strong></td>
<td align="left">Name of the law task. Suggested value: <code>ProdTask</code></td>
</tr>
<tr>
<td align="left">localProcessing / <strong>workflow</strong></td>
<td align="left">Workflow type. Currently, only the <code>htcondor</code> workflow is supported</td>
</tr>
<tr>
<td align="left">localProcessing / <strong>bootstrap</strong></td>
<td align="left">Bootstrap file to load environment on a remote node. Suggested value: <code>bootstrap.sh</code></td>
</tr>
<tr>
<td align="left">localProcessing / <strong>requirements</strong></td>
<td align="left">(optional) additional requirement for a remote node</td>
</tr>
<tr>
<td align="left"><strong>targetOutputFileSize</strong></td>
<td align="left">Desired size of the output files in MiB. Suggested value: 2048</td>
</tr>
<tr>
<td align="left"><strong>renewKerberosTicket</strong></td>
<td align="left">Periodically renew the validity of a Kerberos ticket. Suggested value: <code>True</code> if run on AFS; otherwise <code>False</code></td>
</tr>
<tr>
<td align="left"><strong>whitelistFinalRecovery</strong></td>
<td align="left">list of "most reliable" sites where the final recovery will be performed</td>
</tr>
</tbody>
</table>
<p>Example configuration file:
<div class="highlight"><pre><span></span><code><span class="nt">cmsswPython</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/nanoProdWrapper.py</span>
<span class="nt">params</span><span class="p">:</span>
<span class="w">  </span><span class="nt">customise</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NanoProd/NanoProd/customize.customize</span>
<span class="w">  </span><span class="nt">skimCfg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">skim_htt.yaml</span>
<span class="w">  </span><span class="nt">skimSetup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">skim</span>
<span class="w">  </span><span class="nt">skimSetupFailed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">skim_failed</span>
<span class="w">  </span><span class="nt">maxEvents</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1</span>
<span class="nt">splitting</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FileBased</span>
<span class="nt">unitsPerJob</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="nt">scriptExe</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/crabJob.sh</span>
<span class="nt">outputFiles</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nano.root</span>
<span class="nt">filesToTransfer</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/crabJob.sh</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/crabJob.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/crabJob_nanoProd.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/skim_tree.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">RunKit/sh_tools.py</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NanoProd/config/skim_htt.yaml</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NanoProd/python/customize.py</span>
<span class="nt">site</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T2_CH_CERN</span>
<span class="nt">crabOutput</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/store/group/phys_tau/kandroso/prod</span>
<span class="nt">localCrabOutput</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/eos/cms/store/group/phys_tau/kandroso/prod</span>
<span class="nt">finalOutput</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/eos/cms/store/group/phys_tau/kandroso/final</span>
<span class="nt">maxMemory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2500</span>
<span class="nt">numCores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="nt">inputDBS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">global</span>
<span class="nt">allowNonValid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">dryrun</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">False</span>
<span class="nt">maxRecoveryCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="nt">updateInterval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="nt">localProcessing</span><span class="p">:</span>
<span class="w">  </span><span class="nt">lawTask</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ProdTask</span>
<span class="w">  </span><span class="nt">workflow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">htcondor</span>
<span class="w">  </span><span class="nt">bootstrap</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bootstrap.sh</span>
<span class="nt">targetOutputFileSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2048</span>
<span class="nt">renewKerberosTicket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>
<span class="nt">whitelistFinalRecovery</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T1_DE_KIT</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T2_CH_CERN</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T2_DE_DESY</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T2_IT_Legnaro</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">T3_CH_PSI</span>
</code></pre></div></p>
<h2 id="task-configuration-file-format">Task configuration file format<a class="headerlink" href="#task-configuration-file-format" title="Permanent link">&para;</a></h2>
<p>The task configuration file uses the <a href="https://en.wikipedia.org/wiki/YAML">YAML</a> format.
Each file contains a list of tasks with the same set of parameters.
The parameters defined in the task configuration file overwrite the parameters defined in the <a href="#main-config-file-format">main configuration file</a>.</p>
<h3 id="format">Format<a class="headerlink" href="#format" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>config</strong>: Section with the task-specific parameters. Same as for the <a href="#supported-parameters">main configuration</a> |</li>
<li>all items with names different from "config" are considered task descriptions. Two formats are possible:<ul>
<li>short format:
    <div class="highlight"><pre><span></span><code><span class="nt">dataset_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dataset_path</span>
</code></pre></div>
    Example:
    <div class="highlight"><pre><span></span><code><span class="nt">TTTo2L2Nu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/RunIISummer20UL18MiniAODv2-106X_upgrade2018_realistic_v16_L1v1-v1/MINIAODSIM</span>
</code></pre></div></li>
<li>
<p>long format, where some parameters are overwritten:
    <div class="highlight"><pre><span></span><code><span class="nt">dataset_name</span><span class="p">:</span>
<span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dataset_path</span>
<span class="w">    </span><span class="nt">param1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
<span class="nn">...</span>
</code></pre></div></p>
<p>Example:
<div class="highlight"><pre><span></span><code><span class="nt">QCD_HT200to300</span><span class="p">:</span>
<span class="w">    </span><span class="nt">inputDataset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/QCD_HT200to300_TuneCP5_13TeV-madgraphMLM-pythia8/RunIISummer20UL18MiniAODv2-106X_upgrade2018_realistic_v16_L1v1-v2/MINIAODSIM</span>
<span class="w">    </span><span class="nt">ignoreFiles</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/store/mc/RunIISummer20UL18MiniAODv2/QCD_HT200to300_TuneCP5_13TeV-madgraphMLM-pythia8/MINIAODSIM/106X_upgrade2018_realistic_v16_L1v1-v2/70000/C38FF40C-E9F0-CB48-B9C7-1E874A4AF010.root</span>
</code></pre></div></p>
</li>
</ul>
</li>
</ul>
<p>Example configuration file:
<div class="highlight"><pre><span></span><code><span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">params</span><span class="p">:</span>
<span class="w">    </span><span class="nt">sampleType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mc</span>
<span class="w">    </span><span class="nt">era</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run2_2018</span>
<span class="w">    </span><span class="nt">storeFailed</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">True</span>

<span class="nt">TTTo2L2Nu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/TTTo2L2Nu_TuneCP5_13TeV-powheg-pythia8/RunIISummer20UL18MiniAODv2-106X_upgrade2018_realistic_v16_L1v1-v1/MINIAODSIM</span>
<span class="nt">TTToHadronic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/TTToHadronic_TuneCP5_13TeV-powheg-pythia8/RunIISummer20UL18MiniAODv2-106X_upgrade2018_realistic_v16_L1v1-v1/MINIAODSIM</span>
<span class="nt">TTToSemiLeptonic</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/TTToSemiLeptonic_TuneCP5_13TeV-powheg-pythia8/RunIISummer20UL18MiniAODv2-106X_upgrade2018_realistic_v16_L1v1-v2/MINIAODSIM</span>
</code></pre></div></p>
<h2 id="actions">Actions<a class="headerlink" href="#actions" title="Permanent link">&para;</a></h2>
<p>When something goes wrong and automatic recovery fails, it could be necessary to apply some manual manipulations to the tasks.
Such intervention can be done by using <code>crabOverseer</code> actions. Alternatively, manual editing of task configuration and status files could be required in complicated cases.</p>
<p>Action is applied from a command line on the selected tasks.
Tasks can be selected with the <code>--select</code> argument using Python syntax.
Selection is applied to each individual <a href="https://github.com/kandrosov/RunKit/blob/main/crabTask.py">crabTask</a> object.</p>
<p>Examples:</p>
<ul>
<li><code>--select 'name == "TTTo2L2Nu"'</code> : select task with name <code>TTTo2L2Nu</code></li>
<li><code>--select 'task.params["sampleType"] == "mc"'</code>: select all tasks that process MC datasets</li>
</ul>
<p>The following actions are supported:</p>
<ul>
<li>
<p><strong>print</strong>: print names of the selected tasks</p>
<p>Example:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span>print<span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;task.params[&quot;sampleType&quot;] == &quot;mc&quot;&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>list_files_to_process</strong>: print a list of files that are yet to be processed</p>
<p>Example:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span>list_files_to_process<span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;name == &quot;TTTo2L2Nu&quot;&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>kill</strong>: kill selected tasks</p>
<p>Example:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span><span class="nb">kill</span><span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;name == &quot;TTTo2L2Nu&quot;&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>remove</strong>: remove selected tasks (<strong>cannot be undone!</strong>)</p>
<p>Example:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span>remove<span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;name == &quot;TTTo2L2Nu&quot;&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>remove_final_output</strong>: remove final outputs of selected tasks</p>
<p>Example:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span>remove_final_output<span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;name == &quot;TTTo2L2Nu&quot;&#39;</span>
</code></pre></div></p>
</li>
<li>
<p><strong>run_cmd</strong>: execute the specified Python code on each selected task</p>
<p>Examples:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span><span class="s1">&#39;run_cmd task.kill()&#39;</span><span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;name == &quot;TTTo2L2Nu&quot;&#39;</span>
python<span class="w"> </span>RunKit/crabOverseer.py<span class="w"> </span>--action<span class="w"> </span><span class="s1">&#39;run_cmd task.taskStatus.status = status.WaitingForRecovery&#39;</span><span class="w"> </span>--select<span class="w"> </span><span class="s1">&#39;name == &quot;TTTo2L2Nu&quot;&#39;</span>
</code></pre></div></p>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href=".." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Home
              </div>
            </div>
          </a>
        
        
          
          <a href="../skim_tree/" class="md-footer__link md-footer__link--next" aria-label="Next: skim_tree" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                skim_tree
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.action.edit", "content.action.view", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="https://unpkg.com/mermaid@9.3/dist/mermaid.min.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        
      
    
  </body>
</html>